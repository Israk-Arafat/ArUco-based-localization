<launch>
  <!-- ArUco Localization System Launch File -->
  <!-- This launch file starts all components needed for ArUco-based localization -->
  
  <!-- Camera Node: gscam with CSI camera -->
  <node name="gscam_driver_nvgst" pkg="gscam" exec="gscam_node" output="screen">
    <param name="camera_name" value="default"/>
    <param name="camera_info_url" value="package://py_pubsub/launch/csi_cam_640x360.ini"/>
    <param name="gscam_config" value="nvarguscamerasrc sensor-id=0 ! video/x-raw(memory:NVMM), width=(int)640, height=(int)360, framerate=10/1, format=(string)NV12 ! nvvidconv ! videoconvert"/>
    <param name="frame_id" value="camera_link"/>
    <param name="sync_sink" value="true"/>
  </node>

  <!-- ArUco Detection Node -->
  <node name="aruco_opencv" pkg="aruco_opencv" exec="aruco_tracker_autostart" output="screen">
    <param name="cam_base_topic" value="/camera/image_raw"/>
    <param name="marker_size" value="0.05"/>
    <param name="marker_dict" value="4X4_50"/>
    <param name="publish_tf" value="false"/>  <!-- We'll publish our own TF -->
    <param name="output_frame" value="camera_link"/>
  </node>

  <!-- Static TF: Marker Positions in Map Frame -->
  <node name="marker_tf_publisher" pkg="py_pubsub" exec="marker_tf_publisher" output="screen">
    <param name="marker_map_file" value="marker_map.yaml"/>
    <param name="map_frame" value="map"/>
  </node>

  <!-- Static TF: Camera to Base Link -->
  <!-- Adjust these values based on your robot's camera mounting position -->
  <node pkg="tf2_ros" exec="static_transform_publisher" name="camera_to_base_link"
        args="0.1 0 0.05 0 0 0 base_link camera_link"/>

  <!-- ArUco Localization Node: Computes robot pose from marker detections -->
  <node name="aruco_localizer" pkg="py_pubsub" exec="aruco_localizer" output="screen">
    <param name="marker_map_file" value="marker_map.yaml"/>
    <param name="camera_frame" value="camera_link"/>
    <param name="base_frame" value="base_link"/>
    <param name="map_frame" value="map"/>
    <param name="use_closest_marker" value="true"/>
    <param name="max_marker_distance" value="2.0"/>
  </node>

  <!-- <node pkg="jetbot_ros" exec="motors_waveshare" name="motors_waveshare"/> -->

</launch>
